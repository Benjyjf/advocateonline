container_commands:
  01_install_solr:
    command: "
    wget http://archive.apache.org/dist/lucene/solr/7.5.0/solr-7.5.0.tgz &&
    tar xzf solr-7.5.0.tgz "
    leader_only: true
  02writable_dirs:
    command: "sudo chmod -R 775 solr-7.5.0/"
  03_generate_schema:
    command: "python manage.py build_solr_schema --configure-directory=solr-7.5.0/server/solr/tester/conf --reload-core"
  04_rebuild_index:
    command: "python manage.py rebuild_index --noinput"
    leader_only: true
commands:
  create_post_dir:
    command: "mkdir /opt/elasticbeanstalk/hooks/appdeploy/post"
    ignoreErrors: true

files:
  "/opt/elasticbeanstalk/hooks/appdeploy/post/start_solr.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/usr/bin/env bash
      sudo nohup java -jar /opt/python/current/app/solr-7.5.0/example/start.jar queue:work --daemon >/dev/null 2>&1 &